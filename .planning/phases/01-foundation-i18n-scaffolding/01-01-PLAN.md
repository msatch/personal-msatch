---
phase: 01-foundation-i18n-scaffolding
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - next.config.ts
  - tsconfig.json
  - postcss.config.mjs
  - src/proxy.ts
  - src/i18n/routing.ts
  - src/i18n/navigation.ts
  - src/i18n/request.ts
  - messages/es.json
  - messages/en.json
  - src/lib/utils.ts
autonomous: true

must_haves:
  truths:
    - "Running npm run dev starts a Next.js development server on localhost"
    - "The project has next-intl, clsx, and tailwind-merge installed as dependencies"
    - "i18n routing config defines es as defaultLocale and en as secondary locale"
    - "proxy.ts detects browser locale from Accept-Language and persists choice via NEXT_LOCALE cookie"
    - "Translation JSON files exist for both es and en with nested namespace structure"
  artifacts:
    - path: "package.json"
      provides: "Next.js 16 project with next-intl, clsx, tailwind-merge dependencies"
      contains: "next-intl"
    - path: "next.config.ts"
      provides: "Next.js config wrapped with createNextIntlPlugin"
      contains: "createNextIntlPlugin"
    - path: "src/proxy.ts"
      provides: "Locale detection and routing middleware"
      contains: "createMiddleware"
    - path: "src/i18n/routing.ts"
      provides: "Locale routing configuration"
      contains: "defineRouting"
    - path: "src/i18n/navigation.ts"
      provides: "Locale-aware navigation exports"
      contains: "createNavigation"
    - path: "src/i18n/request.ts"
      provides: "Request-scoped message loading"
      contains: "getRequestConfig"
    - path: "messages/es.json"
      provides: "Spanish translation strings with nested namespaces"
    - path: "messages/en.json"
      provides: "English translation strings with nested namespaces"
    - path: "src/lib/utils.ts"
      provides: "cn() utility combining clsx + tailwind-merge"
      contains: "twMerge"
  key_links:
    - from: "next.config.ts"
      to: "src/i18n/request.ts"
      via: "createNextIntlPlugin auto-wires request config"
      pattern: "createNextIntlPlugin"
    - from: "src/proxy.ts"
      to: "src/i18n/routing.ts"
      via: "import routing config for middleware"
      pattern: "import.*routing"
    - from: "src/i18n/request.ts"
      to: "messages/*.json"
      via: "dynamic import of translation files"
      pattern: "import.*messages"
---

<objective>
Scaffold a Next.js 16 project with TypeScript, Tailwind CSS 4, and App Router. Install and configure next-intl for bilingual (es/en) URL-based routing with locale detection and cookie persistence. Remove the old vanilla MVP files. Create the cn() utility.

Purpose: Establish the project foundation and i18n infrastructure that all subsequent phases build on. i18n is the costliest thing to retrofit, so it goes in first.
Output: A runnable Next.js project with i18n routing config, translation JSON files, and proxy.ts locale detection -- but not yet rendering locale-specific content (that is Plan 02).
</objective>

<execution_context>
@C:/Users/matia/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/matia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-i18n-scaffolding/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js 16 project and remove old MVP files</name>
  <files>
    package.json
    next.config.ts
    tsconfig.json
    postcss.config.mjs
    src/app/layout.tsx (scaffolded, will be replaced in Plan 02)
    src/app/page.tsx (scaffolded, will be replaced in Plan 02)
    .gitignore
  </files>
  <action>
    1. Delete the old MVP files that the Next.js project replaces:
       - Remove `server.mjs`
       - Remove the entire `web/` directory
       - Remove the existing `package.json` (will be regenerated)

    2. Scaffold the Next.js 16 project in the current directory:
       ```bash
       npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --yes
       ```
       Note: The `--yes` flag accepts defaults. The `.` installs into the current directory. If the scaffolder complains about existing files (README.md, .gitignore, docs/), temporarily move them, scaffold, then restore.

    3. Install i18n and utility dependencies:
       ```bash
       npm install next-intl
       npm install clsx tailwind-merge
       ```

    4. Verify the scaffolded project:
       - Confirm `postcss.config.mjs` uses `@tailwindcss/postcss` (Tailwind v4 pattern). If it uses the old `tailwindcss` + `autoprefixer` plugins, replace with:
         ```javascript
         export default {
           plugins: {
             "@tailwindcss/postcss": {},
           },
         };
         ```
       - Confirm `next.config.ts` exists (will be modified in Task 2).
       - Confirm `tsconfig.json` has `"@/*"` path alias pointing to `"./src/*"`.
       - Run `npm run dev` briefly to confirm the scaffolded project starts without errors, then stop it.

    5. Update `.gitignore` to include:
       - `.env.local` (already in Next.js default)
       - `tmp/` (from old MVP leads storage)
       - Ensure `.next/`, `node_modules/`, `out/` are covered.
  </action>
  <verify>
    - `ls server.mjs` returns "not found" (file deleted)
    - `ls web/` returns "not found" (directory deleted)
    - `npm run dev` starts and shows "Ready" or similar Next.js startup message on localhost:3000
    - `package.json` contains "next", "next-intl", "clsx", "tailwind-merge" as dependencies
    - `postcss.config.mjs` references "@tailwindcss/postcss"
  </verify>
  <done>
    A clean Next.js 16 project runs on localhost with TypeScript, Tailwind CSS 4, ESLint, and App Router. Old MVP files (server.mjs, web/) are removed. next-intl, clsx, and tailwind-merge are installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure next-intl i18n infrastructure and translation files</name>
  <files>
    next.config.ts
    src/proxy.ts
    src/i18n/routing.ts
    src/i18n/navigation.ts
    src/i18n/request.ts
    messages/es.json
    messages/en.json
    src/lib/utils.ts
  </files>
  <action>
    1. **next.config.ts** -- Wrap with createNextIntlPlugin:
       ```typescript
       import type { NextConfig } from 'next';
       import createNextIntlPlugin from 'next-intl/plugin';

       const nextConfig: NextConfig = {};
       const withNextIntl = createNextIntlPlugin();
       export default withNextIntl(nextConfig);
       ```

    2. **src/i18n/routing.ts** -- Define locale routing:
       ```typescript
       import { defineRouting } from 'next-intl/routing';

       export const routing = defineRouting({
         locales: ['es', 'en'],
         defaultLocale: 'es',
         localePrefix: 'always',
         localeCookie: {
           name: 'NEXT_LOCALE',
           maxAge: 60 * 60 * 24 * 365  // 1 year
         }
       });
       ```
       CRITICAL: `defaultLocale` MUST be `'es'` (Spanish primary, LatAm target market).

    3. **src/i18n/navigation.ts** -- Create locale-aware navigation:
       ```typescript
       import { createNavigation } from 'next-intl/navigation';
       import { routing } from './routing';

       export const { Link, redirect, usePathname, useRouter, getPathname } =
         createNavigation(routing);
       ```

    4. **src/i18n/request.ts** -- Configure request-scoped message loading:
       ```typescript
       import { getRequestConfig } from 'next-intl/server';
       import { hasLocale } from 'next-intl';
       import { routing } from './routing';

       export default getRequestConfig(async ({ requestLocale }) => {
         const requested = await requestLocale;
         const locale = hasLocale(routing.locales, requested)
           ? requested
           : routing.defaultLocale;

         return {
           locale,
           messages: (await import(`../../messages/${locale}.json`)).default
         };
       });
       ```

    5. **src/proxy.ts** -- Create locale detection proxy (Next.js 16 uses proxy.ts, NOT middleware.ts):
       ```typescript
       import createMiddleware from 'next-intl/middleware';
       import { routing } from './i18n/routing';

       export default createMiddleware(routing);

       export const config = {
         matcher: '/((?!api|trpc|_next|_vercel|.*\\..*).*)'
       };
       ```
       Place in `src/` directory (since we used --src-dir). If Next.js does not recognize proxy.ts in `src/`, move to project root. Verify by checking that visiting `/` redirects to `/es/`.

    6. **messages/es.json** -- Spanish translations (nested namespaces from day one):
       ```json
       {
         "metadata": {
           "title": "M. Gripe | Consultoría Técnica y de Negocios",
           "description": "Ayudo a empresas en LatAm a convertir objetivos de negocio en ejecución técnica con claridad, velocidad y resultados medibles."
         },
         "common": {
           "cta": "Agenda tu diagnóstico de 45 min",
           "language": "Idioma",
           "nav": {
             "home": "Inicio",
             "bio": "Bio",
             "services": "Servicios",
             "contact": "Contacto"
           }
         },
         "home": {
           "hero": {
             "title": "Convierto objetivos de negocio en ejecución técnica",
             "subtitle": "Consultoría estratégica y técnica para fundadores, gerentes y PYMEs en Latinoamérica"
           }
         }
       }
       ```

    7. **messages/en.json** -- English translations (mirror same namespace structure):
       ```json
       {
         "metadata": {
           "title": "M. Gripe | Technical & Business Consulting",
           "description": "I help companies in LatAm convert business goals into technical execution with clarity, speed, and measurable outcomes."
         },
         "common": {
           "cta": "Book your 45-min diagnostic",
           "language": "Language",
           "nav": {
             "home": "Home",
             "bio": "Bio",
             "services": "Services",
             "contact": "Contact"
           }
         },
         "home": {
           "hero": {
             "title": "Converting business goals into technical execution",
             "subtitle": "Strategic and technical consulting for founders, managers, and SMEs in Latin America"
           }
         }
       }
       ```

    8. **src/lib/utils.ts** -- Create cn() utility:
       ```typescript
       import { clsx, type ClassValue } from 'clsx';
       import { twMerge } from 'tailwind-merge';

       export function cn(...inputs: ClassValue[]) {
         return twMerge(clsx(inputs));
       }
       ```

    9. Delete any `middleware.ts` file if create-next-app generated one (Next.js 16 uses proxy.ts).
  </action>
  <verify>
    - `cat src/i18n/routing.ts` shows `defaultLocale: 'es'`
    - `cat messages/es.json | python -m json.tool` parses without error and contains `metadata.title`
    - `cat messages/en.json | python -m json.tool` parses without error and contains `metadata.title`
    - `cat next.config.ts` contains `createNextIntlPlugin`
    - `cat src/proxy.ts` contains `createMiddleware` and matcher config
    - `ls src/i18n/` shows routing.ts, navigation.ts, request.ts
    - `cat src/lib/utils.ts` contains `cn` function with `twMerge`
    - `npm run dev` still starts without errors
  </verify>
  <done>
    next-intl i18n infrastructure is fully configured: proxy.ts handles locale detection from Accept-Language with cookie persistence, routing defines es (primary) and en locales, navigation exports locale-aware Link/redirect/usePathname, request.ts loads messages per locale, and both translation JSON files exist with nested namespace structure. cn() utility is ready.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run dev` starts Next.js on localhost without errors
2. `package.json` lists next, next-intl, clsx, tailwind-merge as dependencies
3. All six i18n files exist: src/proxy.ts, src/i18n/routing.ts, src/i18n/navigation.ts, src/i18n/request.ts, messages/es.json, messages/en.json
4. `server.mjs` and `web/` directory no longer exist
5. Project compiles with TypeScript (no type errors on `npm run build` or dev startup)
</verification>

<success_criteria>
- Next.js 16 development server starts cleanly on localhost
- next-intl, clsx, tailwind-merge are in package.json dependencies
- i18n routing config has es as defaultLocale
- Translation JSON files have nested namespace structure for both locales
- Old MVP files (server.mjs, web/) are removed
- cn() utility function exists and exports correctly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-i18n-scaffolding/01-01-SUMMARY.md`
</output>
