---
phase: 08-privacy-analytics-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - messages/es.json
  - messages/en.json
  - src/app/[locale]/privacy/page.tsx
  - src/types/gtag.d.ts
  - .env.local
  - .env.example
autonomous: true
requirements: [ANLYT-03]
user_setup:
  - service: google-tag-manager
    why: "GTM container ID needed for analytics integration in Plan 02"
    env_vars:
      - name: NEXT_PUBLIC_GTM_ID
        source: "Google Tag Manager console -> Admin -> Container Settings -> Container ID (GTM-XXXXXXX)"
    dashboard_config:
      - task: "Create a GTM container (Web type) if one does not exist"
        location: "https://tagmanager.google.com/ -> Create Account/Container"
      - task: "Create a GA4 property and add it as a tag inside the GTM container"
        location: "GTM console -> Tags -> New -> Google Analytics: GA4 Configuration -> set Measurement ID"

must_haves:
  truths:
    - "Privacy policy page in both languages accurately describes the use of GA4 analytics cookies, what data is collected, and how visitors can control it"
    - "Privacy policy no longer states 'we do not use tracking cookies' in either language"
    - "Consent translation namespace exists in both languages with banner text for accept, reject, message, and aria label"
    - "TypeScript declarations for window.dataLayer and window.gtag exist so analytics components compile"
  artifacts:
    - path: "messages/es.json"
      provides: "Updated privacy.sections.cookies with analytics disclosure + new consent namespace"
      contains: "consent"
    - path: "messages/en.json"
      provides: "Updated privacy.sections.cookies with analytics disclosure + new consent namespace"
      contains: "consent"
    - path: "src/app/[locale]/privacy/page.tsx"
      provides: "Updated privacy page rendering cookies items list and control paragraph"
      contains: "cookies"
    - path: "src/types/gtag.d.ts"
      provides: "TypeScript global declarations for window.dataLayer and window.gtag"
      contains: "dataLayer"
    - path: ".env.example"
      provides: "Documented GTM environment variable"
      contains: "NEXT_PUBLIC_GTM_ID"
  key_links:
    - from: "src/app/[locale]/privacy/page.tsx"
      to: "messages/*.json"
      via: "getTranslations('privacy')"
      pattern: "sections\\.cookies\\.items"
---

<objective>
Update the privacy policy to accurately disclose analytics cookie usage, add bilingual consent banner translations, set up TypeScript declarations for GTM globals, and configure the GTM environment variable.

Purpose: ANLYT-03 requires the privacy policy to disclose analytics/tracking cookies before any analytics code is added. This plan also lays the groundwork (types, translations, env vars) that Plan 02 needs to build the analytics components.

Output: Updated privacy policy in both languages, consent namespace in translation files, TypeScript global declarations, env var setup.
</objective>

<execution_context>
@C:/Users/matia/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/matia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-privacy-analytics-foundation/08-RESEARCH.md

@src/app/[locale]/privacy/page.tsx
@messages/es.json
@messages/en.json

<interfaces>
<!-- Privacy page component structure (from src/app/[locale]/privacy/page.tsx) -->

```typescript
const sectionKeys = [
  'dataCollected', 'dataUsage', 'dataProcessing', 'dataRetention',
  'userRights', 'cookies', 'contact',
] as const;

const sectionItemCounts: Record<string, string[]> = {
  dataCollected: ['1', '2', '3', '4', '5'],
  dataUsage: ['1', '2', '3'],
  userRights: ['1', '2', '3'],
};
// Note: 'cookies' key is NOT in sectionItemCounts yet -- must be added
```

<!-- Locale layout head section (from src/app/[locale]/layout.tsx) -->

```typescript
<head>
  <script dangerouslySetInnerHTML={{
    __html: `(function(){try{var t=localStorage.getItem('theme');...}catch(e){}})()`,
  }} />
</head>
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update privacy policy translations and add consent namespace</name>
  <files>messages/es.json, messages/en.json</files>
  <action>
In both `messages/es.json` and `messages/en.json`, make two changes:

**Change 1: Replace `privacy.sections.cookies`**

The current cookies section says "we do not use tracking cookies" (or the Spanish equivalent). Replace the entire `cookies` object inside `privacy.sections` with the expanded version that discloses GA4 analytics cookies.

In `messages/es.json`, replace `privacy.sections.cookies` with:
```json
"cookies": {
  "title": "Cookies",
  "content": "Este sitio utiliza los siguientes tipos de cookies:",
  "items": {
    "1": "Cookie t\u00e9cnica (NEXT_LOCALE): recuerda tu preferencia de idioma. Es estrictamente necesaria para el funcionamiento del sitio.",
    "2": "Cookie de consentimiento (cookie_consent): almacena tu decisi\u00f3n sobre cookies de an\u00e1lisis. Expira en 1 a\u00f1o.",
    "3": "Cookies de Google Analytics (v\u00eda Google Tag Manager): si aceptas las cookies de an\u00e1lisis, GA4 utiliza cookies como _ga y _ga_* para generar informaci\u00f3n estad\u00edstica sobre el uso del sitio, como p\u00e1ginas visitadas y duraci\u00f3n de la visita. Estos datos son an\u00f3nimos y se procesan de forma agregada."
  },
  "control": "Puedes gestionar tus preferencias de cookies en cualquier momento. Si rechazas las cookies de an\u00e1lisis, no se recopilar\u00e1 ning\u00fan dato de navegaci\u00f3n. Para retirar tu consentimiento, puedes eliminar las cookies de tu navegador."
}
```

In `messages/en.json`, replace `privacy.sections.cookies` with:
```json
"cookies": {
  "title": "Cookies",
  "content": "This site uses the following types of cookies:",
  "items": {
    "1": "Technical cookie (NEXT_LOCALE): remembers your language preference. Strictly necessary for site functionality.",
    "2": "Consent cookie (cookie_consent): stores your analytics cookie decision. Expires in 1 year.",
    "3": "Google Analytics cookies (via Google Tag Manager): if you accept analytics cookies, GA4 uses cookies such as _ga and _ga_* to generate statistical information about site usage, such as pages visited and visit duration. This data is anonymous and processed in aggregate."
  },
  "control": "You can manage your cookie preferences at any time. If you decline analytics cookies, no browsing data will be collected. To withdraw your consent, you can clear cookies from your browser."
}
```

**Change 2: Add `consent` namespace (top-level key)**

In `messages/es.json`, add a new top-level `"consent"` key:
```json
"consent": {
  "ariaLabel": "Preferencias de cookies",
  "message": "Usamos cookies de an\u00e1lisis para entender c\u00f3mo se utiliza este sitio y mejorar tu experiencia. Puedes aceptar o rechazar su uso.",
  "accept": "Aceptar",
  "reject": "Rechazar",
  "privacyLink": "Pol\u00edtica de privacidad"
}
```

In `messages/en.json`, add a new top-level `"consent"` key:
```json
"consent": {
  "ariaLabel": "Cookie preferences",
  "message": "We use analytics cookies to understand how this site is used and improve your experience. You can accept or decline their use.",
  "accept": "Accept",
  "reject": "Decline",
  "privacyLink": "Privacy policy"
}
```

Also update `privacy.lastUpdated` in both files to reflect the current date (February 2026).
  </action>
  <verify>
    <automated>grep -c "cookie_consent" messages/es.json messages/en.json && grep -c "\"consent\"" messages/es.json messages/en.json && echo "PASS: cookies section updated and consent namespace added"</automated>
  </verify>
  <done>
- privacy.sections.cookies in both languages describes NEXT_LOCALE, cookie_consent, and GA4 cookies with items list
- privacy.sections.cookies.control paragraph exists in both languages
- consent namespace exists in both languages with ariaLabel, message, accept, reject, privacyLink keys
- No trace of "we do not use tracking cookies" or "No utilizamos cookies de seguimiento" remains
  </done>
</task>

<task type="auto">
  <name>Task 2: Update privacy page component to render cookie items and control paragraph</name>
  <files>src/app/[locale]/privacy/page.tsx</files>
  <action>
Modify `src/app/[locale]/privacy/page.tsx` to render the new cookies items list and control paragraph.

**Change 1:** Add `cookies` to the `sectionItemCounts` map:
```typescript
const sectionItemCounts: Record<string, string[]> = {
  dataCollected: ['1', '2', '3', '4', '5'],
  dataUsage: ['1', '2', '3'],
  userRights: ['1', '2', '3'],
  cookies: ['1', '2', '3'],
};
```

**Change 2:** Add a conditional rendering block after the items `<ul>` to render the `control` paragraph when the section has one. Define an array of section keys that have a control field:

```typescript
const sectionsWithControl = ['cookies'] as const;
```

Then, inside the `sectionKeys.map()`, after the `{sectionItemCounts[key] && (...)}` block, add:

```tsx
{sectionsWithControl.includes(key as typeof sectionsWithControl[number]) && (
  <p className="mt-4 text-base md:text-lg leading-relaxed">
    {t(`sections.${key}.control`)}
  </p>
)}
```

This renders the `control` paragraph after the cookies items list. The approach is general enough to support control paragraphs on other sections if needed later, but currently only cookies uses it.
  </action>
  <verify>
    <automated>cd "C:/Users/matia/OneDrive/Escritorio/mgripe/all-claude/personal-msatch" && npx next build 2>&1 | tail -5</automated>
  </verify>
  <done>
- Privacy page renders cookies section with 3 items (NEXT_LOCALE, cookie_consent, GA4 cookies)
- Control paragraph renders below the cookies items list
- Build succeeds without errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Create TypeScript global declarations and environment variable setup</name>
  <files>src/types/gtag.d.ts, .env.local, .env.example</files>
  <action>
**File 1: Create `src/types/gtag.d.ts`**

Create the TypeScript global declarations file so analytics components in Plan 02 can reference `window.dataLayer` and `window.gtag` without type errors:

```typescript
declare global {
  interface Window {
    dataLayer: Record<string, unknown>[];
    gtag: (...args: unknown[]) => void;
  }
}

export {};
```

The `export {}` at the bottom is required to make TypeScript treat this as a module with global augmentation (without it, the `declare global` block would not work correctly).

**File 2: Create or update `.env.local`**

Add the GTM ID environment variable with a placeholder value:
```
NEXT_PUBLIC_GTM_ID=GTM-XXXXXXX
```

If `.env.local` already exists, append this line. Do NOT overwrite existing content. If it does not exist, create it with just this line.

**File 3: Create or update `.env.example`**

Add documentation for the GTM environment variable:
```
# Google Tag Manager container ID (get from GTM console)
NEXT_PUBLIC_GTM_ID=GTM-XXXXXXX
```

If `.env.example` already exists, append these lines. If it does not exist, create it with these lines.
  </action>
  <verify>
    <automated>cd "C:/Users/matia/OneDrive/Escritorio/mgripe/all-claude/personal-msatch" && test -f src/types/gtag.d.ts && grep -q "dataLayer" src/types/gtag.d.ts && grep -q "NEXT_PUBLIC_GTM_ID" .env.example && echo "PASS: types and env configured"</automated>
  </verify>
  <done>
- src/types/gtag.d.ts exists with Window.dataLayer and Window.gtag declarations
- .env.local contains NEXT_PUBLIC_GTM_ID placeholder
- .env.example documents the GTM environment variable
- TypeScript compilation succeeds with the new declarations
  </done>
</task>

</tasks>

<verification>
1. `grep -r "No utilizamos cookies de seguimiento\|We do not use tracking" messages/` returns zero results
2. `grep -c "cookie_consent" messages/es.json messages/en.json` returns at least 1 match per file
3. `grep -c "\"consent\"" messages/es.json messages/en.json` returns at least 1 match per file
4. `npx next build` succeeds without errors
5. Privacy page at /es/privacy and /en/privacy renders the cookies section with 3 items and a control paragraph
</verification>

<success_criteria>
- Privacy policy in both languages accurately describes GA4 analytics cookies, consent cookie, and technical cookie
- Privacy policy includes a "control" paragraph explaining how to manage cookie preferences
- Consent banner translations exist in both languages (message, accept, reject, ariaLabel, privacyLink)
- TypeScript globals declared for window.dataLayer and window.gtag
- GTM environment variable documented and placeholder set
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/08-privacy-analytics-foundation/08-01-SUMMARY.md`
</output>
