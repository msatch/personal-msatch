---
phase: 07-deployment-launch
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .env.example
  - src/components/layout/whatsapp-button.tsx
autonomous: false
requirements:
  - DEPLOY-01
user_setup:
  - service: vercel
    why: "Hosting and deployment platform"
    env_vars:
      - name: RESEND_API_KEY
        source: "Resend Dashboard -> API Keys (https://resend.com/api-keys)"
      - name: RESEND_FROM_EMAIL
        source: "Your verified sending domain email (e.g., 'M. Gripe Website <noreply@mgripe.com>')"
      - name: RESEND_TO_EMAIL
        source: "Email address where contact form submissions should be delivered"
      - name: NEXT_PUBLIC_GTM_ID
        source: "Google Tag Manager -> Admin -> Container ID (format: GTM-XXXXXXX)"
    dashboard_config:
      - task: "Import GitHub repo (msatch/personal-msatch) in Vercel dashboard"
        location: "https://vercel.com/new"
  - service: resend
    why: "Email delivery for contact form"
    env_vars:
      - name: RESEND_API_KEY
        source: "Resend Dashboard -> API Keys"
    dashboard_config:
      - task: "Verify sending domain (add SPF + DKIM DNS records)"
        location: "Resend Dashboard -> Domains -> Add Domain"
  - service: google-tag-manager
    why: "Analytics container for GA4"
    dashboard_config:
      - task: "Create GTM container and GA4 tag if not already done"
        location: "https://tagmanager.google.com"

must_haves:
  truths:
    - "Site is deployed to Vercel and accessible via a public *.vercel.app URL"
    - "Build succeeds on Vercel with zero errors"
    - "All 4 environment variables are configured in Vercel project settings"
  artifacts:
    - path: ".env.example"
      provides: "Reference for all required environment variables"
      contains: "RESEND_API_KEY"
    - path: "src/components/layout/whatsapp-button.tsx"
      provides: "WhatsApp CTA with configurable phone number"
      contains: "WHATSAPP_NUMBER"
  key_links:
    - from: "Vercel project settings"
      to: "RESEND_API_KEY env var"
      via: "Server-side environment variable"
      pattern: "process\\.env\\.RESEND_API_KEY"
    - from: "Vercel project settings"
      to: "NEXT_PUBLIC_GTM_ID env var"
      via: "Client-side build-time variable"
      pattern: "process\\.env\\.NEXT_PUBLIC_GTM_ID"
---

<objective>
Prepare the codebase for production deployment and deploy to Vercel via CLI.

Purpose: Get the site live on a public URL (DEPLOY-01). This involves final code preparation (WhatsApp number, env var documentation), confirming the build passes, and deploying to Vercel with proper environment variable configuration.

Output: Live site on *.vercel.app URL with all environment variables configured.
</objective>

<execution_context>
@C:/Users/matia/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/matia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-deployment-launch/07-RESEARCH.md
@.env.example
@src/components/layout/whatsapp-button.tsx
@next.config.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pre-deployment code preparation</name>
  <files>.env.example, src/components/layout/whatsapp-button.tsx</files>
  <action>
1. Update `.env.example` to accurately reflect all environment variables needed for production. The current file has some legacy variables (HOST, PORT, LEADS_FILE, MAX_SUBMISSIONS_PER_WINDOW, RATE_LIMIT_WINDOW_MS) that are NOT used by the Next.js application. Clean it up to list only the 4 production-relevant variables:

```
# Resend email service (server-side only -- no NEXT_PUBLIC_ prefix)
RESEND_API_KEY=re_your_api_key_here
RESEND_FROM_EMAIL=M. Gripe Website <noreply@mgripe.com>
RESEND_TO_EMAIL=contact@mgripe.com

# Google Tag Manager container ID (client-side, inlined at build time)
NEXT_PUBLIC_GTM_ID=GTM-XXXXXXX
```

2. In `src/components/layout/whatsapp-button.tsx`, convert the hardcoded `WHATSAPP_NUMBER` constant from `'5215512345678'` to read from an environment variable with fallback. Change to:

```typescript
const WHATSAPP_NUMBER = process.env.NEXT_PUBLIC_WHATSAPP_NUMBER || '5215512345678';
```

This keeps the placeholder as fallback but allows the real number to be set via environment variable without a code change. Add `NEXT_PUBLIC_WHATSAPP_NUMBER` to `.env.example` as well:

```
# WhatsApp CTA phone number (with country code, no + sign)
NEXT_PUBLIC_WHATSAPP_NUMBER=5215512345678
```

3. Run `next build` to verify the production build still succeeds after changes.

4. Commit the changes: "chore(07): prepare codebase for Vercel deployment"
  </action>
  <verify>
    <automated>cd "C:/Users/matia/OneDrive/Escritorio/mgripe/all-claude/personal-msatch" && npx next build 2>&1 | tail -5</automated>
  </verify>
  <done>
- `.env.example` contains exactly the 5 production environment variables (RESEND_API_KEY, RESEND_FROM_EMAIL, RESEND_TO_EMAIL, NEXT_PUBLIC_GTM_ID, NEXT_PUBLIC_WHATSAPP_NUMBER) with no legacy variables
- WhatsApp button reads from `NEXT_PUBLIC_WHATSAPP_NUMBER` env var with placeholder fallback
- `next build` succeeds with zero errors
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Deploy to Vercel and configure environment variables</name>
  <what-built>The codebase is build-ready with all production environment variables documented in .env.example. The Vercel CLI (v50.25.4) is available locally.</what-built>
  <action>
Claude will attempt to deploy via Vercel CLI. The user needs to:

1. **Authenticate with Vercel** (if not already): The executor will run `vercel whoami` to check. If not authenticated, the user must run `vercel login` or provide a token.

2. **Provide environment variable values** for the Vercel project. The executor will use `vercel env add` to set each one, but the user must provide the actual secret values:
   - `RESEND_API_KEY` -- from https://resend.com/api-keys
   - `RESEND_FROM_EMAIL` -- e.g., `M. Gripe Website <noreply@mgripe.com>` (or `onboarding@resend.dev` if domain not yet verified)
   - `RESEND_TO_EMAIL` -- the real email to receive contact form submissions
   - `NEXT_PUBLIC_GTM_ID` -- from Google Tag Manager container (or leave unset to skip analytics initially)
   - `NEXT_PUBLIC_WHATSAPP_NUMBER` -- real WhatsApp business number with country code

3. **Deploy**: The executor will run `vercel --prod` to deploy to production.

If the user prefers to use the Vercel web dashboard instead of CLI:
- Go to https://vercel.com/new
- Import the `msatch/personal-msatch` GitHub repo
- Add environment variables in Project Settings > Environment Variables
- Deploy

Either path achieves the same result.
  </action>
  <how-to-verify>
    1. Run `vercel whoami` -- should show your Vercel username
    2. Run `vercel --prod` from the project root -- should deploy successfully
    3. Copy the production URL from the deploy output
    4. Visit the URL in a browser -- site should load
  </how-to-verify>
  <resume-signal>Share the production URL (e.g., https://personal-msatch.vercel.app) and confirm environment variables are configured. Type "deployed" with the URL.</resume-signal>
</task>

</tasks>

<verification>
- `next build` produces zero errors and generates 14 static pages
- `.env.example` documents all 5 production environment variables
- WhatsApp number is configurable via environment variable
- Site is accessible at a public Vercel URL
</verification>

<success_criteria>
The site is deployed to Vercel and accessible via a public URL (DEPLOY-01). The production build succeeds and all environment variables are configured in the Vercel project.
</success_criteria>

<output>
After completion, create `.planning/phases/07-deployment-launch/07-01-SUMMARY.md`
</output>
