---
phase: 02-layout-shell-navigation
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - src/app/[locale]/not-found.tsx
  - src/app/[locale]/[...rest]/page.tsx
  - src/app/not-found.tsx
  - src/app/[locale]/page.tsx
autonomous: true
requirements: [TECH-08, NAV-01]

must_haves:
  truths:
    - "Visiting a nonexistent URL under a locale (e.g., /es/nonexistent) shows a styled 404 page with translated text in the current locale"
    - "Visiting a nonexistent URL outside locale segments shows a bilingual fallback 404"
    - "The 404 page includes a link to return to the home page"
    - "Valid routes (home, bio, services, contact) are NOT intercepted by the catch-all -- they still render normally"
    - "The home page no longer has temporary nav/locale-switch elements (layout shell handles navigation)"
  artifacts:
    - path: "src/app/[locale]/not-found.tsx"
      provides: "Localized 404 page content"
      contains: "useTranslations"
    - path: "src/app/[locale]/[...rest]/page.tsx"
      provides: "Catch-all route that triggers notFound()"
      contains: "notFound()"
    - path: "src/app/not-found.tsx"
      provides: "Root 404 fallback for non-locale paths"
      contains: "404"
    - path: "src/app/[locale]/page.tsx"
      provides: "Home page without temporary nav elements"
      contains: "generateStaticParams"
  key_links:
    - from: "src/app/[locale]/[...rest]/page.tsx"
      to: "src/app/[locale]/not-found.tsx"
      via: "notFound() triggers Next.js not-found boundary"
      pattern: "notFound\\(\\)"
    - from: "src/app/[locale]/not-found.tsx"
      to: "messages/*.json"
      via: "useTranslations('notFound')"
      pattern: "useTranslations.*notFound"
---

<objective>
Implement the localized 404 page using the three-file pattern (catch-all + locale not-found + root not-found), and clean up the home page by removing temporary navigation elements that are now handled by the layout shell.

Purpose: Complete the Phase 2 layout shell by ensuring unknown URLs show a proper error page, and the home page is ready for Phase 3 content.
Output: Localized 404 page, catch-all route, styled root 404 fallback, cleaned-up home page.
</objective>

<execution_context>
@C:/Users/matia/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/matia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-layout-shell-navigation/02-RESEARCH.md
@.planning/phases/02-layout-shell-navigation/02-01-SUMMARY.md
@src/app/[locale]/layout.tsx
@src/app/[locale]/page.tsx
@src/app/not-found.tsx
@messages/es.json
@messages/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement localized 404 page with three-file pattern</name>
  <files>
    src/app/[locale]/not-found.tsx
    src/app/[locale]/[...rest]/page.tsx
    src/app/not-found.tsx
  </files>
  <action>
Implement the three-file 404 pattern documented in 02-RESEARCH.md Pattern 4. The translation keys (`notFound` namespace) were already added in Plan 01.

**File 1: `src/app/[locale]/[...rest]/page.tsx`** (catch-all route)

Create a minimal page that calls `notFound()` from `next/navigation`. This catches any URL under `[locale]/` that does not match a real route (bio, services, contact, home) and triggers the not-found boundary.

```typescript
import { notFound } from 'next/navigation';

export default function CatchAllPage() {
  notFound();
}
```

This file should be minimal -- just the import and the function. No `generateStaticParams` needed because this is a dynamic catch-all that only runs when no static route matches.

**IMPORTANT:** This file MUST be created AFTER the stub pages from Plan 01 exist. Next.js gives priority to more specific route segments (`[locale]/bio/page.tsx`) over catch-all segments (`[locale]/[...rest]/page.tsx`). If stub pages are missing, the catch-all will incorrectly intercept valid routes. Verify `/es/bio`, `/es/services`, `/es/contact` still load correctly after adding this file.

**File 2: `src/app/[locale]/not-found.tsx`** (localized 404 content)

This renders inside the locale layout (inherits Header, main, Footer from `[locale]/layout.tsx`). Uses `useTranslations('notFound')` for translated content.

```typescript
import { useTranslations } from 'next-intl';
import { Link } from '@/i18n/navigation';

export default function NotFoundPage() {
  const t = useTranslations('notFound');

  return (
    <div className="flex flex-col items-center justify-center min-h-[60vh] px-4 text-center">
      <h1 className="text-6xl font-bold">404</h1>
      <p className="mt-4 text-lg text-muted">{t('message')}</p>
      <Link
        href="/"
        className="mt-8 text-accent hover:text-accent-dark transition-colors font-medium"
      >
        {t('backHome')}
      </Link>
    </div>
  );
}
```

Use `Link` from `@/i18n/navigation` (not a plain `<a>` tag) so the "Back to home" link preserves the current locale prefix.

**File 3: `src/app/not-found.tsx`** (root fallback -- UPDATE existing)

Update the existing `src/app/not-found.tsx` to be styled and bilingual. This fires when the URL does not match any locale segment at all (e.g., if proxy.ts somehow fails to redirect). Mark it `'use client'` since it cannot use next-intl outside a locale context.

```typescript
'use client';

export default function RootNotFound() {
  return (
    <html lang="es">
      <body className="min-h-screen flex items-center justify-center bg-white text-gray-900 font-sans antialiased">
        <div className="text-center px-4">
          <h1 className="text-6xl font-bold">404</h1>
          <p className="mt-4 text-gray-500">
            Pagina no encontrada / Page not found
          </p>
          <a
            href="/"
            className="mt-8 inline-block text-blue-600 hover:text-blue-800 transition-colors font-medium"
          >
            Volver al inicio / Back to home
          </a>
        </div>
      </body>
    </html>
  );
}
```

Use plain HTML/inline Tailwind classes (not design tokens) since this page renders outside the [locale] layout and may not have access to the theme system. Use `<a href="/">` (not next-intl Link) since there is no locale context.
  </action>
  <verify>
1. Run `npm run build` -- build succeeds
2. Run `npm run dev` and test:
   - Visit `http://localhost:3000/es/nonexistent` -- shows 404 page in Spanish with "Lo sentimos..." message, inside the layout shell (header + footer visible)
   - Visit `http://localhost:3000/en/nonexistent` -- shows 404 page in English with "Sorry..." message
   - Visit `http://localhost:3000/es/bio` -- still renders the Bio stub page (NOT 404)
   - Visit `http://localhost:3000/es/services` -- still renders Services stub page
   - Visit `http://localhost:3000/es/contact` -- still renders Contact stub page
   - The "Back to home" link on the 404 page navigates to the correct locale home page
  </verify>
  <done>
Three-file 404 pattern is in place: catch-all route triggers `notFound()`, localized not-found page shows translated content inside the layout shell, root not-found provides bilingual fallback. Valid routes are not intercepted by the catch-all.
  </done>
</task>

<task type="auto">
  <name>Task 2: Clean up home page for layout shell</name>
  <files>
    src/app/[locale]/page.tsx
  </files>
  <action>
The current home page at `src/app/[locale]/page.tsx` contains temporary elements from Phase 1 that are now handled by the layout shell:

1. **Remove the temporary locale switch link** at the top (the `<div className="flex justify-end p-4">` block with the `<Link>` that shows `otherLocale.toUpperCase()`). This is now the Header's language toggle.

2. **Remove the temporary nav links preview** at the bottom (the `<nav className="border-t border-border py-8 px-4">` block showing locale and nav labels). This is now the Header's navigation.

3. **Remove unused imports/variables:** The `Link` import from `@/i18n/navigation`, the `tCommon` and `tNav` translations, and the `otherLocale` variable are no longer needed if only used by the removed elements. Keep `getTranslations` for `'home.hero'` since the hero section stays.

4. **Remove the `<main>` wrapper:** The layout now provides `<main className="flex-1">`, so the home page should NOT have its own `<main>` tag. Replace `<main className="min-h-screen flex flex-col">` with a simpler wrapper like `<div>` or just return the sections directly.

5. **Keep the hero section intact** -- it will be replaced with full content in Phase 3, but for now it serves as placeholder content that proves the layout works.

The resulting page should be a simple server component with:
- `generateStaticParams` (keep)
- `setRequestLocale(locale)` (keep)
- `getTranslations('home.hero')` (keep)
- Hero section with title, subtitle, CTA button (keep)
- No `<main>` wrapper (layout provides it)
- No temporary nav/locale elements (layout provides them)

Keep the existing `getTranslations` import for `'home.hero'` and the `routing` import for `generateStaticParams`.
  </action>
  <verify>
1. Run `npm run build` -- build succeeds
2. Visit `http://localhost:3000/es/` -- hero section is visible, no duplicate nav or locale toggle, header and footer from layout are present
3. Visit `http://localhost:3000/en/` -- same, with English content
4. The page has NO `<main>` tag (inspect element) -- the `<main>` comes from the layout only
  </verify>
  <done>
Home page is cleaned up: no temporary nav preview, no temporary locale toggle, no `<main>` wrapper. It renders only the hero content section inside the layout shell. Ready for Phase 3 to replace with full home page content.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes with zero errors
2. `/es/nonexistent` shows Spanish 404 with header, footer, "Volver al inicio" link
3. `/en/nonexistent` shows English 404 with header, footer, "Back to home" link
4. `/es/bio`, `/es/services`, `/es/contact` still render correctly (not intercepted by catch-all)
5. Home page has no duplicate navigation or locale toggle elements
6. "Back to home" link on 404 preserves locale (goes to `/es/` or `/en/` respectively)
</verification>

<success_criteria>
- Localized 404 page renders translated content inside the layout shell
- Catch-all route triggers 404 for unknown paths without breaking valid routes
- Root 404 fallback provides bilingual message for edge cases
- Home page is clean with no temporary Phase 1 elements
- `npm run build` passes with all routes static
</success_criteria>

<output>
After completion, create `.planning/phases/02-layout-shell-navigation/02-02-SUMMARY.md`
</output>
